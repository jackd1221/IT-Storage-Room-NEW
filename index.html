<!DOCTYPE html>
<html>
<head>
    <title>Tech Storage Check Out/In</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Tech Storage Check Out/In</h1>
  
  <form id="checkout-form">
      <label for="item">Item:</label>
      <select id="item" name="item" required>
          <option value="">--Select Item--</option>
          <option value="iPad Elementary">iPad Elementary</option>
          <option value="iPad Middle">iPad Middle</option>
          <option value="Keyboard iPad Case">Keyboard iPad Case</option>
          <option value="iPad Case">iPad Case</option>
          <option value="New iPad Charging Block">New iPad Charging Block</option>
          <option value="Old iPad Charging Block">Old iPad Charging Block</option>
          <option value="MacBook">MacBook</option>
          <option value="MacBook Charging Block">MacBook Charging Block</option>
          <option value="Apple TV">Apple TV</option>
          <option value="USB A to USB C Cable">USB A to USB C Cable</option>
          <option value="MacBook USB C Charging Cable">MacBook USB C Charging Cable</option>
          <option value="iPad USB C Charging Cable">iPad USB C Charging Cable</option>
          <option value="6' HDMI Cable">6' HDMI Cable</option>
          <option value="10' HDMI Cable">10' HDMI Cable</option>
          <option value="Charging Station">Charging Station</option>
          <option value="420 IP Phone">420 IP Phone</option>
          <option value="480 IP Phone">480 IP Phone</option>
          <option value="480G IP Phone">480G IP Phone</option>
          <option value="Roku TV Remote">Roku TV Remote</option>
          <option value="Google Remotes">Google Remotes</option>
      </select>

      <label for="quantity">Quantity:</label>
      <input type="number" id="quantity" name="quantity" min="1" value="1" required>

      <label for="user">Name:</label>
      <input type="text" id="user" name="user" required>

      <label for="location">Location:</label>
      <select id="location" name="location" required>
          <option value="">--Select Location--</option>
          <option value="LaVergne">LaVergne</option>
          <option value="Off-Site Pre School">Off-Site Pre School</option>
          <option value="Out Of District">Out Of District</option>
          <option value="Emerson">Emerson</option>
          <option value="Piper">Piper</option>
          <option value="Pershing">Pershing</option>
          <option value="Irving">Irving</option>
          <option value="Hiawatha">Hiawatha</option>
          <option value="Komensky">Komensky</option>
          <option value="Freedom">Freedom</option>
          <option value="Heritage">Heritage</option>
          <option value="Other">Other</option>
      </select>

      <label for="action">Action:</label>
      <select id="action" name="action" required>
          <option value="checkout">Check Out</option>
          <option value="checkin">Check In</option>
      </select>

      <button type="submit" id="submit-btn">Submit</button>
      <button type="button" id="clear-btn">Clear</button>
      
      <div id="loading" class="loading">Processing...</div>
      <div id="result"></div>
  </form>

  <script>
      const form = document.getElementById("checkout-form");
      const submitBtn = document.getElementById("submit-btn");
      const clearBtn = document.getElementById("clear-btn");
      const loadingDiv = document.getElementById("loading");
      const resultDiv = document.getElementById("result");

      // Clear form
      clearBtn.addEventListener("click", () => {
          form.reset();
          resultDiv.innerHTML = "";
      });

      // Form submission
      form.addEventListener("submit", async (e) => {
          e.preventDefault();

          // Show loading state
          submitBtn.disabled = true;
          submitBtn.textContent = "Submitting...";
          loadingDiv.style.display = "block";
          resultDiv.innerHTML = "";

          try {
              // Collect form data
              const formData = new FormData();
              formData.append('item', document.getElementById("item").value);
              formData.append('quantity', document.getElementById("quantity").value);
              formData.append('user', document.getElementById("user").value);
              formData.append('location', document.getElementById("location").value);
              formData.append('action', document.getElementById("action").value);

              // Send request - this avoids CORS issues
              const response = await fetch("https://script.google.com/macros/s/AKfycbzwvFjfn3_Gw51XYQDVuhGy1wob3JOqQ_L31bIn_mf3GuFY4a8tyG-vteCohBv7pVaflQ/exec", {
                  method: "POST",
                  body: formData
              });

              const result = await response.text();
              
              // Show result
              if (result.includes("error") || result.includes("not found") || result.includes("Not enough")) {
                  resultDiv.innerHTML = `<span class="error">${result}</span>`;
              } else {
                  resultDiv.innerHTML = `<span class="success">${result}</span>`;
                  form.reset(); // Clear form on success
              }

          } catch (error) {
              console.error("Error:", error);
              resultDiv.innerHTML = `<span class="error">Network error. Please try again.</span>`;
          } finally {
              // Reset button state
              submitBtn.disabled = false;
              submitBtn.textContent = "Submit";
              loadingDiv.style.display = "none";
          }
      });
  </script>
</body>
</html>